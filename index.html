<script src="/socket.io/socket.io.js"></script>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<input type="text" placeholder="tweet id" id="id" />
<input type="button" value="Add" id="add" />


<script defer>
  const socket = io(location.href.replace('http', 'ws'), {
    transports: ['websocket']
  });

  window.socket = socket;


  /*
  const errorImpl = console.error;
  console.error = function error(message) {
    errorImpl.apply(this, arguments);
    if (message.startsWith('WebSocket')) {
      console.error('__ WebSocket Removed');
    }
  };
  */

  socket.on('log', function(msg) {

    console.info(msg);

  });

  socket.on('error', (...args) => {

    console.error(...args);
  });

  socket.on('observe-tweets', (tweets) => {


    for (const {
        id,
        oembed
      } of tweets) {

      const div = document.createElement('div');
      div.innerHTML = `



        <div><h1>${id}</h1>


        <input type="button" class="remove-observe-tweet" value="Remove" data-id="${id}"

            onclick="socket.emit('remove-target-tweet', ${id})"

        />
        </div>

        ${oembed}


        <hr>

        `;

        twttr.widgets.load(div);

      document.body.appendChild(div);

    }

    // console.info('OTIDS' + ids);

  });





  document.querySelector('#add').addEventListener('click', function() {
    const id = document.querySelector('#id').value;

    console.log('add: ', id);

    socket.emit('add-target-tweet', id);


    location.reload();
  });



  socket.on('error', function(msg) {
    console.error(msg);
  });
</script>
